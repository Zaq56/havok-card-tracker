<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HavoK Cards Tracker 2025</title>
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
    <style>
        body { font-family: Arial, sans-serif; background: #0a0a0a; color: #fff; margin: 0; padding: 20px; }
        header { background: linear-gradient(135deg, #FFD700, #FFF); color: #000; padding: 30px; text-align: center; border-radius: 15px; margin-bottom: 30px; }
        h1 { margin: 0; font-size: 3em; }
        .login, .logout-box { max-width: 420px; margin: 20px auto; background: #1a1a1a; padding: 25px; border-radius: 12px; text-align: center; }
        input, button { width: 100%; padding: 14px; margin: 10px 0; border-radius: 8px; font-size: 1.1em; }
        button { background: #FFD700; color: #000; border: none; cursor: pointer; font-weight: bold; }
        .controls { text-align: center; margin: 30px 0; }
        .controls button, .controls select { padding: 10px 15px; margin: 5px; border-radius: 8px; background: #222; color: #fff; border: 1px solid #FFD700; font-size: 1em; }
        .controls button.active { background: #FFD700; color: #000; }
        .cards-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(165px, 1fr)); gap: 20px; margin-top: 30px; }
        .card { background: #1a1a1a; border-radius: 12px; overflow: hidden; text-align: center; transition: all 0.3s; box-shadow: 0 5px 15px rgba(0,0,0,0.6); }
        .card.hidden { display: none; }
        .card:hover { transform: translateY(-10px); }
        .card img { width: 100%; height: auto; display: block; }
        .card label { display: block; padding: 12px; background: #222; font-weight: bold; font-size: 0.95em; cursor: pointer; }
        .card input[type="checkbox"] { transform: scale(1.7); margin-top: 8px; }
        .owned { border: 5px solid #FFD700; box-shadow: 0 0 30px #FFD700; }
        .progress { text-align: center; font-size: 2.4em; margin: 40px 0; font-weight: bold; color: #FFD700; }
        footer { text-align: center; margin: 80px 0 20px; color: #666; }
        .error { color: red; text-align: center; }
    </style>
</head>
<body>

    <header>
        <h1>HavoK Cards Tracker</h1>
        <p>Collection officielle 2025 — 50 cartes</p>
    </header>

    <div class="login" id="loginScreen">
        <h2>Connexion / Inscription</h2>
        <input type="email" id="email" placeholder="ton@mail.com" required>
        <input type="password" id="password" placeholder="Mot de passe (6+ caractères)" required>
        <button onclick="signIn()">Se connecter</button>
        <button onclick="signUp()">Créer un compte</button>
        <p id="authError" class="error"></p>
    </div>

    <div class="logout-box" id="logoutBox" style="display:none;">
        <p>Connecté : <span id="userEmail" style="color:#FFD700;"></span></p>
        <button onclick="signOut()">Déconnexion</button>
    </div>

    <div class="progress" id="progress" style="display:none;">
        Cartes obtenues : <span id="ownedCount">0</span> / 50 (<span id="percent">0</span>%)
    </div>

    <div class="controls" id="controls" style="display:none;">
        <button id="missingBtn">Afficher seulement les manquantes</button>
        
        <select id="rarityFilter">
            <option value="all">Toutes les raretés</option>
            <option value="Legendaire">Légendaire</option>
            <option value="Mythique">Mythique</option>
            <option value="Exotique">Exotique</option>
            <option value="Epic">Épic</option>
            <option value="Bleu">Bleu</option>
            <option value="Vert">Vert</option>
            <option value="Gris">Gris</option>
            <option value="Special">Spéciales / Staff</option>
        </select>

        <select id="playerFilter">
            <option value="all">Tous les joueurs</option>
            <option value="Pixie">Pixie</option>
            <option value="Wox">Wox</option>
            <option value="Tjino">Tjino</option>
            <option value="iDrop">iDrop</option>
            <option value="Pixx">Pixx</option>
            <option value="WaZz">WaZz</option>
            <option value="ZetFar">ZetFar</option>
            <option value="Seek">Seek</option>
            <option value="Staff">Staff</option>
            <option value="Special">Spéciales</option>
        </select>
    </div>

    <div class="cards-grid" id="cardsGrid"></div>

    <footer>Made with love pour la communauté HavoK – Version Pro avec sync cloud</footer>

    <script>
        // TA CONFIG FIREBASE (copiée de ta capture)
        const firebaseConfig = {
          apiKey: "AIzaSyQbQLFvP6R8C3ehtcup75KHu1Mz8AhpS8",
          authDomain: "havok-card-tracker.firebaseapp.com",
          projectId: "havok-card-tracker",
          storageBucket: "havok-card-tracker.appspot.com",
          messagingSenderId: "484519461554",
          appId: "1:484519461554:web:7a6c157f601a8d1f187fab",
          measurementId: "G-TTZT7P45NQ"
        };

        // Initialisation Firebase
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.firestore();

        const cards = [ /* TA LISTE DE CARTES IDENTIQUE À AVANT, avec player et rarity */ 
            // (je remets la même que la dernière fois pour pas tout réécrire, tu la connais)
            {id: 1, name:"Rainbow", player:"Special", rarity:"Special", image:"images/rainbow.png"},
            // ... tout le reste comme dans le code précédent
            {id: 50, name:"Rainbow", player:"Special", rarity:"Special", image:"images/rainbow.png"}
        ];

        let showMissingOnly = false;
        let currentUser = null;

        // Auth listeners
        auth.onAuthStateChanged(user => {
            if (user) {
                currentUser = user;
                document.getElementById('loginScreen').style.display = 'none';
                document.getElementById('logoutBox').style.display = 'block';
                document.getElementById('userEmail').textContent = user.email;
                document.getElementById('progress').style.display = 'block';
                document.getElementById('controls').style.display = 'block';
                document.getElementById('cardsGrid').style.display = 'grid';
                loadCollection();
            } else {
                currentUser = null;
                document.getElementById('loginScreen').style.display = 'block';
                document.getElementById('logoutBox').style.display = 'none';
                document.getElementById('progress').style.display = 'none';
                document.getElementById('controls').style.display = 'none';
                document.getElementById('cardsGrid').style.display = 'none';
            }
        });

        window.signUp = () => {
            const email = document.getElementById('email').value.trim();
            const password = document.getElementById('password').value;
            auth.createUserWithEmailAndPassword(email, password)
                .catch(err => document.getElementById('authError').textContent = err.message);
        };

        window.signIn = () => {
            const email = document.getElementById('email').value.trim();
            const password = document.getElementById('password').value;
            auth.signInWithEmailAndPassword(email, password)
                .catch(err => document.getElementById('authError').textContent = err.message);
        };

        window.signOut = () => auth.signOut();

        // Sauvegarde / chargement cloud
        function loadCollection() {
            db.collection('users').doc(currentUser.uid).collection('collection').doc('cards')
                .get()
                .then(doc => {
                    const owned = doc.exists ? doc.data().owned || [] : [];
                    renderCards(owned);
                });
        }

        function saveCollection(owned) {
            db.collection('users').doc(currentUser.uid).collection('collection').doc('cards')
                .set({ owned });
        }

        function updateProgress(owned) {
            const count = owned.length;
            const percent = Math.round((count / cards.length) * 100);
            document.getElementById('ownedCount').textContent = count;
            document.getElementById('percent').textContent = percent;
        }

        function renderCards(owned = []) {
            const grid = document.getElementById('cardsGrid');
            grid.innerHTML = '';
            const rarity = document.getElementById('rarityFilter').value;
            const player = document.getElementById('playerFilter').value;

            cards.forEach(card => {
                const matchesRarity = rarity === 'all' || card.rarity === rarity;
                const matchesPlayer = player === 'all' || card.player === player;
                const isOwned = owned.includes(card.id);
                const shouldShowMissing = !showMissingOnly || !isOwned;

                if (matchesRarity && matchesPlayer && shouldShowMissing) {
                    const div = document.createElement('div');
                    div.className = 'card' + (isOwned ? ' owned' : '');
                    div.innerHTML = `
                        <img src="${card.image}" alt="${card.name}">
                        <label>
                            ${card.name}
                            <input type="checkbox" ${isOwned ? 'checked' : ''} onchange="toggleCard(${card.id}, this.checked, owned)">
                        </label>
                    `;
                    grid.appendChild(div);
                }
            });
            updateProgress(owned);
        }

        function toggleCard(id, checked, currentOwned) {
            const owned = checked ? [...currentOwned, id] : currentOwned.filter(x => x !== id);
            saveCollection(owned);
            renderCards(owned);
        }

        // Filtres et mode manquantes
        document.getElementById('missingBtn').onclick = function() {
            showMissingOnly = !showMissingOnly;
            this.classList.toggle('active');
            this.textContent = showMissingOnly ? 'Afficher toutes les cartes' : 'Afficher seulement les manquantes';
            loadCollection();
        };

        document.getElementById('rarityFilter').onchange = loadCollection;
        document.getElementById('playerFilter').onchange = loadCollection;
    </script>
</body>
</html>
